# HRV Analysis

The **HRV Analysis** folder contains scripts and tools used for processing and analyzing heart rate variability (HRV) data from the EmotiBit sensor in real time. This folder includes core functionalities such as detecting PPG (Photoplethysmography) peaks, calculating RMSSD HRV, simulating sensor data for testing purposes, and interfacing with the game via a server.

## Files Overview

### peaks_hrv_functions.py

This file contains functions for detecting PPG peaks using a Butter bandpass filter and calculating RMSSD HRV (Root Mean Square of Successive Differences). These functions are crucial for the real-time analysis and are used by the **data_processor.py** script to assess the user's heart rate variability.

- **PPG Peaks Detection:** Identifies the peaks in the PPG data.
- **RMSSD Calculation:** Computes the RMSSD HRV, which is used to determine anxiety levels.

### dummy_sensor.py

This script is used for testing the entire real-time data processing pipeline. It simulates the behavior of the EmotiBit sensor by sending previously recorded data from the `real_time_data/live_output.txt` file to the same port that the real sensor would use. This allows us to test the functionality of the system without requiring the actual sensor.

- **Purpose:** Testing the systemâ€™s functionality (not the accuracy of values).
- **Source of Data:** Sends recorded EmotiBit measurements from a file.

### data_processor.py

This file is responsible for calculating HRV values in real time. It processes incoming PPG data, calculates the HRV, and determines which type of output should be sent to the game. The outputs are based on several parameters, such as previous HRV values, to ensure adaptive responses within the game.

- **HRV Calculation:** Processes PPG data to compute HRV values using functions from **peaks_hrv_functions.py**.
- **Output Management:** Sends various outputs to the game based on the real-time analysis.

### server.py

This script implements a server to handle real-time data analysis from the EmotiBit sensor. It listens for incoming PPG data on a specific port, queues the data, and processes it using the **data_processor.py** functions. The server also exposes a Flask-based web endpoint (`/results_json`) that allows Unity to access the processed results in real time. There is also another endpoint (`/results`) that allows us to view the results in real time in the form of a table.

- **Listener:** Captures data sent from the sensor and processes it in real time.
- **Queue:** Manages the flow of PPG data for real-time processing.
- **Flask Server:** Provides an endpoint for Unity to access HRV results during gameplay.

### data_processor_log.txt

This file stores logs generated by the **data_processor.py** during the real-time analysis. The log file allows for tracking and accessing logs in real time, but also saves them for later reference. However, if the server is restarted, the contents of this file are deleted, ensuring that only current session data is logged.

- **Real-Time Logs:** Logs from the data processor are written in real time.
- **Log Persistence:** The file can be accessed to view logs during or after analysis, but its contents are cleared when the server restarts.

## Usage

1. **PPG Data Processing:** Use the `peaks_hrv_functions.py` to detect PPG peaks and compute RMSSD HRV.
2. **Testing the Pipeline:** Use the `dummy_sensor.py` to simulate real-time sensor data and test the entire data processing workflow.
3. **Real-Time HRV Calculation:** The `data_processor.py` script continuously calculates HRV values and prepares outputs for the game.
4. **Server Integration:** Use `server.py` to expose the HRV results to Unity through a Flask endpoint for real-time game adjustments.
5. **Log Tracking:** Access `data_processor_log.txt` to view real-time logs or analyze logs post-session, noting that the file is reset on server restart.
